For the first part, we have $f = hg = h ~ id_B ~ g = h g h g = f f$.

Now, suppose $f$ is an idempotent map and let $g$ be an epic and $h$ be a monic such that $f = hg$. It suffices to prove $gh = id_B$. From the idempotency of $f$, we have $hghg = hg$. Since $g$ is an epic, it follows that $hgh = h = h ~ id_B$. Finally, $h$ being a monic implies $gh = id_B$.